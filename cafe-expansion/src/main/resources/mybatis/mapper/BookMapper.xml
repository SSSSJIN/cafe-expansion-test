<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kakaopage.expansion.dao.BookMapper">

  <resultMap id="BookResult" type="BookVO">
    <id     property="id"        column="ID"/>
    <result property="title"     column="TITLE"/>
    <result property="episode"   column="EPISODE"/>
    <result property="author"    column="AUTHOR"/>
    <result property="description" column="DESCRIPTION"/>
    <result property="image"     column="IMAGE"/>
    <result property="thumbnail" column="THUMBNAIL"/>
    <result property="regdate"   column="REGDATE"/>
    <result property="category"  column="CATEGORY"/>
  </resultMap>

  <select id="getHotBooks" resultMap="BookResult">
    SELECT ID, TITLE, EPISODE, AUTHOR, DESCRIPTION, IMAGE, THUMBNAIL, REGDATE, CATEGORY
      FROM BOOK
     WHERE CATEGORY = 'HOT'
     ORDER BY REGDATE DESC
     FETCH FIRST 10 ROWS ONLY
  </select>

  <select id="getRankingBooks" resultMap="BookResult">
    SELECT ID, TITLE, EPISODE, AUTHOR, DESCRIPTION, IMAGE, THUMBNAIL, REGDATE, CATEGORY
      FROM BOOK
     WHERE CATEGORY = 'RANKING'
     ORDER BY REGDATE DESC
     FETCH FIRST 10 ROWS ONLY
  </select>

  <select id="getRecentBooks" parameterType="long" resultMap="BookResult">
    SELECT b.ID, b.TITLE, b.EPISODE, b.AUTHOR, b.DESCRIPTION, b.IMAGE, b.THUMBNAIL, b.REGDATE, b.CATEGORY
      FROM BOOK b
      JOIN RECENT_VIEW rv ON b.ID = rv.BOOK_ID
     WHERE rv.USER_ID = #{userId}
     ORDER BY rv.VIEW_DATE DESC
     FETCH FIRST 10 ROWS ONLY
  </select>

  <select id="getAllBooks" resultMap="BookResult">
    SELECT ID, TITLE, EPISODE, AUTHOR, DESCRIPTION, IMAGE, THUMBNAIL, REGDATE, CATEGORY
      FROM BOOK
     ORDER BY REGDATE DESC
  </select>

  <select id="getBookById" parameterType="long" resultMap="BookResult">
    SELECT ID, TITLE, EPISODE, AUTHOR, DESCRIPTION, IMAGE, THUMBNAIL, REGDATE, CATEGORY
      FROM BOOK
     WHERE ID = #{id}
  </select>

  <select id="getBooksByTitle" parameterType="string" resultMap="BookResult">
    SELECT ID, TITLE, EPISODE, AUTHOR, DESCRIPTION, IMAGE, THUMBNAIL, REGDATE, CATEGORY
      FROM BOOK
     WHERE TITLE LIKE '%' || #{title} || '%'
     ORDER BY REGDATE DESC
  </select>

  <insert id="insertBook" parameterType="BookVO">
    INSERT INTO BOOK (TITLE, EPISODE, AUTHOR, DESCRIPTION, IMAGE, THUMBNAIL, CATEGORY, REGDATE)
    VALUES (#{title}, #{episode}, #{author}, #{description}, #{image}, #{thumbnail}, #{category}, #{regdate})
  </insert>

  <update id="updateThumbnail" parameterType="BookVO">
    UPDATE BOOK
       SET THUMBNAIL = #{thumbnail}
     WHERE ID = #{id}
  </update>

</mapper>
