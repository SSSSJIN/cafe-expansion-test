<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kakaopage.expansion.dao.BookMapper">

  <resultMap id="bookResult" type="com.kakaopage.expansion.vo.BookVO">
    <id     property="id"         column="ID"/>
    <result property="title"      column="TITLE"/>
    <result property="author"     column="AUTHOR"/>
    <result property="genre"      column="GENRE"/>
    <result property="description" column="DESCRIPTION"/>
    <result property="imageUrl"   column="IMAGE_URL"/>
    <result property="thumbnail"  column="THUMBNAIL"/>
</resultMap>


  <!-- 실시간 랭킹: 예시로 ID 오름차순 5개 -->
  <select id="getRankingBooks" resultMap="bookResult">
    SELECT * FROM BOOKS_DEMO ORDER BY ID FETCH FIRST 5 ROWS ONLY
  </select>

  <!-- 지금 핫한: 예시로 ID 내림차순 5개 -->
  <select id="getHotBooks" resultMap="bookResult">
    SELECT * FROM BOOKS_DEMO ORDER BY ID DESC FETCH FIRST 5 ROWS ONLY
  </select>

  <!-- 최근 본 목록: 예시로 userId가 있으면 최근 본 책 5개 (임시 더미, 실제 구현 시 조인 필요) -->
  <select id="getRecentBooks" parameterType="long" resultMap="bookResult">
    <!-- 실제 구현에서는 USER_BOOK_HISTORY 등에서 JOIN -->
    SELECT * FROM BOOKS_DEMO ORDER BY ID DESC FETCH FIRST 5 ROWS ONLY
  </select>

  <!-- 전체 책 목록 -->
  <select id="getAllBooks" resultMap="bookResult">
    SELECT * FROM BOOKS_DEMO ORDER BY ID
  </select>

  <!-- ID로 단일 책 조회 -->
  <select id="getBookById" parameterType="long" resultMap="bookResult">
    SELECT * FROM BOOKS_DEMO WHERE ID = #{id}
  </select>

  <!-- 제목으로 책 검색 (부분 일치) -->
  <select id="getBooksByTitle" parameterType="string" resultMap="bookResult">
    SELECT * FROM BOOKS_DEMO WHERE TITLE LIKE '%' || #{title} || '%'
  </select>

  <!-- 책 등록 -->
  <insert id="insertBook" parameterType="com.kakaopage.expansion.vo.BookVO">
    INSERT INTO BOOKS_DEMO (ID, TITLE, AUTHOR, GENRE, DESCRIPTION, IMAGE_URL, THUMBNAIL)
    VALUES (#{id}, #{title}, #{author}, #{genre}, #{description}, #{imageUrl}, #{thumbnail})
  </insert>

  <!-- 썸네일 업데이트 -->
  <update id="updateThumbnail">
    UPDATE BOOKS_DEMO SET THUMBNAIL = #{thumbnail} WHERE ID = #{id}
  </update>

</mapper>
